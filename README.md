# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно подходу MVP:
- слой Model, отвечает за хранение и изменение данных.
- слой View, отвечает за отображение данных на странице.
- слой Presenter, отвечает за связь представления и данных.

## Данные и типы данных, используемые в приложении

Тип для описания категории товаров

```
export type TCategory = 'софт-скилл' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скилл';
```

Тип для описания метода оплаты

```
export type TPaymentMethod = 'Онлайн' | 'При получении';
```

Карточка товара

```
export interface ICard {
	_id: string;
	title: string;
	category: TCategory;
	image: string;
	description: string;
	price: number;
}
```

Данные пользователя

```
export interface IUser {
	email: string;
	phone: string;
}
```

Данные о заказе

```
export interface IOrder {
	address: string;
	payment: TPaymentMethod;
}
```

Отображение товаров на главной странице

```
export type TCardPublic = Pick<ICard, 'title' | 'category' | 'image' | 'price'>;
```

### Базовый код

#### Класс API 
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET-запрос по переданному в параметры эндпоинту и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет данные на эндпоинт, переданный в параметрах при вызове метода. По умолчанию выполняется POST-запрос, но метод может быть переопределен третьим параметром при вызове.

#### Класс EventEmmiter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события,
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и получение данных карточек товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек,
- _preview: string | null - id карточки, выбранной для открытия в модальном окне.
- events: IEvents - экземпляр класса `EventEmmiter` для инициализации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:\
- getCard(cardID: string): ICard - метод для получения карточки по её id.
- а также геттеры и сеттеры для сохранения и получения данных из полей класса.

#### Класс BasketData
Класс отвечает за хранение, получение и удаление товаров, выбранных для оформления заказа\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- cards: ICard[] - массив карточек в корзине,
- total: number - итоговая стоимость товаров,
- events: IEvents - экземпляр класса `EventEmmiter` для инициализации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:\
- addCard(card: ICard): void - добавление карточки в массив,
- deleteCard(cardID: string): void - удаление карточки по id,
- deleteAllCards(): void - удаление всех позиций из корзины,
- getCards() : ICard[] - получение списка карточек.

#### Класс UserData
Класс отвечает за хранение, получение и изменение данных о пользователе\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- email: Pick<IUser, 'email'> - почта пользователя,
- phone: Pick<IUser, 'phone'> - телефон пользователя,
- events: IEvents - экземпляр класса `EventEmmiter` для инициализации событий при - изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:\
- setEmail(email: Pick<IUser, 'email'>): void - добавление почты пользователя,
- setPhone(phone: Pick<IUser, 'phone'>): void - добавление телефона пользователя,
- clearData(): void - очистка данных,
- checkUserInfo(data: Record<keyof IUser, string>): boolean - валидация данных пользователя.

#### Класс OrderData
Класс отвечает за хранение, получение и изменение данных о заказе\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: Pick<IOrder, 'payment'> - метод оплаты,
- address: Pick<IOrder, 'address'> - адрес доставки,
- total: number - итоговая стоимость заказа,
- events: IEvents - экземпляр класса `EventEmmitter` для инициализации событий при - изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:\
- setPayment(paymentMethod: Pick<IOrder, 'payment'>): void - добавление метода оплаты,
- setAddress(address: Pick<IOrder, 'address'>): void - добавление адреса доставки,
- clearData(): void - очистка данных,
- checkOrderInfo(data: Record<keyof IOrder, string>): boolean - валидация данных заказа.

### Слой представления

Классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
- constructor(selector: string, events: IEvents, content: HTMLElement, handleSubmit: Function) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно, экземпляр класса `EventEmmitter` для возможности инициации событий, DOM-элемент с контентом, а также функцию-обработчик нажатия на кнопку подтверждения.

Поля класса:
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий
- content: HTMLElement - контент модального окна
- submitButton: HTMLButtonElement - кнопка подтверждения
- handleSubmit: Function - функция-обработчик подтверждения

Методы класса:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения.

#### Класс Form
Реализует формы заказа и ввода данных пользователя. Также предоставляет метод `checkValid` для обработки ошибок формы.
- constructor(selector: string, events: IEvents)
Конструктор принимает селектор, по которому в разметке страницы будет идентифицирован темплейт формы, экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- form: HTMLElement - темплейт-элемент формы
- formName: string - имя формы
- events: IEvents - брокер событий
- isValid: boolean - состояние валидности полей формы

#### Класс Basket
Класс реализует отображение корзины продуктов.
- constructor(selectorBasket: string, events: IEvents)
Конструктор принимает селектор для выбора темплейта корзины. Также принимает экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- basket: HTMLElement - темплейт корзины
- events: IEvents - брокер событий

#### Класс Card
Класс реализует отображение карточки продуктов, задавая в карточке данные названия, изображения, стоимости, категории, описания.\
Класс используется для отображения карточек на странице сайта. Также содержит методы для открытия карточки.\
Конструктор принимает селектор, по которому будет идентифицирован темплейт карточки, что позволяет при необходимости формировать разные варианты верстки, экземпляр класса `EventEmitter` для возможности инициации событий. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются события.

Методы класса:
- setData(cardData: ICard): void - заполнить атрибуты карточки данными.
- open(cardID: string) - открыть карточку.

#### Класс CardCatalog
Отвечает за отображение блока с карточками на главной странице.\
В конструкторе принимается селектор элемента, в котором размещаются карточки.

#### Класс Success
Класс отвечает за отображение окна об успешной оплате.\
В конструкторе принимает селектор темплейта. Имеет метод для заполнения информации о количестве списанных синапсов.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие предоставления и данных между собой назодится в файле `index.ts`, выполняющие роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.