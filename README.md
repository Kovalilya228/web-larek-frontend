# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно подходу MVP:
- слой Model, отвечает за хранение и изменение данных.
- слой View, отвечает за отображение данных на странице.
- слой Presenter, отвечает за связь представления и данных.

## Данные и типы данных, используемые в приложении

Тип для описания категории товаров

```
export type TCategory = 'софт-скилл' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скилл';
```

Тип для описания метода оплаты

```
export type TPaymentMethod = 'Онлайн' | 'При получении' | 'online' | 'offline';
```

Карточка товара

```
export interface ICard {
    id: string;
    title: string;
    category: TCategory;
    image: string;
    description: string;
    price: string;
    index?: string;
}
```

Данные пользователя

```
export interface IUser {
	email: string;
	phone: string;
}
```

Данные о заказе

```
export interface IOrder {
    address: string;
    payment: TPaymentMethod | null;
}
```

Отображение товаров на главной странице

```
export type TCardPublic = Pick<ICard, 'title' | 'category' | 'image' | 'price'>;
```

### Базовый код

#### Класс API 
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET-запрос по переданному в параметры эндпоинту и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет данные на эндпоинт, переданный в параметрах при вызове метода. По умолчанию выполняется POST-запрос, но метод может быть переопределен третьим параметром при вызове.

#### Класс LarekApi
Класс принимает экземпляр класса API. Используется для удобного взаимодействия с сервером./Предоставляет методы:
- getCatalog() - возвращает каталог карточек с сервера
- getItem(id: string) - возвращает карточку по id
- makeOrder(data: IMakeOrder) - отправляет заявку на оформление заказа по данным data.

#### Класс EventEmmiter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события,
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component
Абстрактный класс, реализующий базовый функционал всех компонентов представления./
В конструкторе принимает свойство container - DOM-элемент.
Предоставляет метод
- render(data?: Partial<T>): HTMLElement - возвращает заполненный данными из data контейнер.

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и получение данных карточек товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек,
- events: IEvents - экземпляр класса `EventEmmiter` для инициализации событий при изменении данных.
- preview: string | null - хранит в себе id карточки, вызываемой в превью 

Также класс предоставляет набор методов для взаимодействия с этими данными:\
- getCard(cardID: string): ICard - метод для получения карточки по её id.
- а также геттеры и сеттеры для сохранения и получения данных из полей класса.

#### Класс BasketData
Класс отвечает за хранение, получение и удаление товаров, выбранных для оформления заказа\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив карточек в корзине,
- events: IEvents - экземпляр класса `EventEmmiter` для инициализации событий при изменении данных.
- _totalPrice: number = 0 - значение итоговой стоимость корзины

Также класс предоставляет набор методов для взаимодействия с этими данными:\
- addCard(card: ICard): void - добавление карточки в массив,
- deleteCard(cardID: string): void - удаление карточки по id,
- deleteAllCards(): void - удаление всех позиций из корзины,
- getCards() : ICard[] - получение списка карточек.
- findTotal(): void - функция, которая считает итоговую стоимость и записывает его в поле _totalPrice
- геттеры для получения данных полей класса.

#### Класс UserData
Класс отвечает за хранение, получение и изменение данных о пользователе\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _email: string - почта пользователя,
- _phone: string - телефон пользователя,
- events: IEvents - экземпляр класса `EventEmmiter` для инициализации событий при - изменении данных.

Также класс предоставляет набор геттеров и сеттеров для взаимодействия с полями.

#### Класс OrderData
Класс отвечает за хранение, получение и изменение данных о заказе\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: TPaymentMethod | null - метод оплаты,
- address: string - адрес доставки,
- events: IEvents - экземпляр класса `EventEmmitter` для инициализации событий при - изменении данных.

Также класс предоставляет набор геттеров и сеттеров для работы с полями.

### Слой представления

Классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Имеет метод для установки контента в окно.
- constructor(protected container: HTMLElement, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно, экземпляр класса `EventEmmitter` для возможности инициации событий, DOM-элемент с контентом.

Поля класса:
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
- events: IEvents - брокер событий
- content: HTMLElement - контент модального окна
- _isActive: boolean - хранит информацию о состоянии окна

#### Класс Form
Реализует форму, предоставляет метод `setButtonState` для установки состояния кнопок формы в зависимости от валидности.
- constructor(container: HTMLFormElement, events: IEvents, handleSubmit: Function)
Конструктор принимает селектор, по которому в разметке страницы будет идентифицирован темплейт формы, экземпляр класса `EventEmitter` для возможности инициации событий и функцию-обработчик подтверждения.

Поля класса:
- events: IEvents - брокер событий
- isValid: boolean - состояние валидности полей формы
- submitButton: HTMLButtonElement - кнопка подтверждения
- handleSubmit: Function - функция-обработчик подтверждения
- formErrors: HTMLElement - элемент для вывода ошибок

#### Классы FormOrder и FormUser
Наследуют класс Form. Реализуют форму заказа и указания личных данных, устанавливают слушатели оценки валидности формы, имеют уникальные поля для собственных значений. Имеют свой метод checkValid для проверки валидности формы. Также имеют набор геттеров и сеттеров для взаимодействия с полями.
- constructor(container: HTMLFormElement, events: IEvents, handleSubmit: Function)
Конструктор принимает селектор, по которому в разметке страницы будет идентифицирован темплейт формы, экземпляр класса `EventEmitter` для возможности инициации событий и функцию-обработчик подтверждения.

#### Класс Basket
Класс реализует отображение корзины продуктов.
- constructor(container: HTMLElement, events: IEvents, handleSubmit: Function)
Конструктор принимает контейнер, экземпляр класса `EventEmitter` для возможности инициации событий и функцию-обработчик сабмита.

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- events: IEvents - брокер событий
- _basketPrice: HTMLElement - отображение стоимости товаров в корзине
- _basketList: HTMLElement - контейнер списка карточек в корзине
- basketButton: HTMLElement - кнопка открытия корзины на главной странице
- _basketCounter: HTMLElement - счетчик элементов над кнопкой открытия

#### Класс Card
Класс реализует отображение карточки продуктов\
Класс используется для отображения карточек на странице сайта\
Конструктор принимает контейнер карточки, по которому будет идентифицировано что это за карточка, что позволяет при необходимости формировать разные варианты верстки, экземпляр класса `EventEmitter` для возможности инициации событий. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются события.

Методы класса:
- delete(): void - удаляет карточку
- геттеры и сеттеры для установки и получения значений в полях

#### Класс CardsCatalog
Отвечает за отображение блока с карточками на главной странице.\
В конструкторе принимается контейнер, в котором размещаются карточки.
Имеет поле catalog: HTMLElement[] - элемент в котором хранятся карточки, а также сеттер для его заполнения.

#### Класс Success
Класс отвечает за отображение окна об успешной оплате.\
В конструкторе принимает контейнер, экземпляр EventEmitter для инициации событий, handleSubmit: Function для обработки подтверждения. Имеет метод для заполнения информации о количестве списанных синапсов.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие предоставления и данных между собой назодится в файле `index.ts`, выполняющие роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.